<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search flight</title>
</head>
<style>
    body{
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }
    .list{
        display: flex;
        justify-content: center;
        width: 200px;
        flex-wrap: wrap;
        gap: 20px;
    }
    .btn{
        width: 180px;
        border: 2px solid black;
        padding: 5px;
        border-radius: 20px;
    }
    input{
        width: 170px;
        border: 2px solid black;
        padding: 5px;
        border-radius: 10px;

    }
    .form{
        border: 2px solid black;
        padding: 50px;
        border-radius: 20px;
    }
    .dropdown{
    position: absolute;
    top: 40px;
    left: 0;
    width: 100%;
    background: white;
    border: 1px solid #ddd;
    max-height: 180px;
    overflow-y: auto;
    z-index: 1000;
    }

    .dropdown div{
        padding: 8px;
        cursor: pointer;
    }

    .dropdown div:hover{
        background: #f2f2f2;
    }

    
</style>
<body>
    <div class="form">
        <form id="searchform">
        <div class="list">
            <div style="position:relative">
                <input type="text" placeholder="from" id="from" autocomplete="off" required>
                <div id="fromList" class="dropdown"></div>
            </div>

            <div style="position:relative">
                <input type="text" placeholder="to" id="to" autocomplete="off" required>
                <div id="toList" class="dropdown"></div>
            </div>

            <input type="date" id="date" required>
            <!-- <input type="date"  id="r_date" placeholder="return date" required>  -->
            <button class="btn">Search</button>
        </div>
    </form>
    </div>

    <div id="result"></div>
</body>
<script>
    const url="http://localhost:3000/";
    let form=document.getElementById("from");
    let formlist=document.getElementById("fromList");
    let to=document.getElementById("to");
    let tolist=document.getElementById("toList");

    document.getElementById("searchform").onsubmit=async(e)=>{
        e.preventDefault();
        let from=form.value;
        let To=to.value;
        let date=document.getElementById("date").value;
        // let r_date=document.getElementById("r_date").value;
        const res=await fetch(`${url}api/flights/search?from=${from}&to=${To}&date=${date}`);
        const data=await res.json();
        const result=document.getElementById("result");
        result.innerHTML="";
        data.forEach(f => {

            const hrs  = Math.floor(f.duration / 60);
            const mins = f.duration % 60;
            const durationText = `${hrs}h ${mins}m`;

            result.innerHTML += `
            <div style="border:1px solid #000;padding:10px;margin:10px;border-radius:10px;">
                <h3>${f.airline}</h3>
                <p>₹ ${f.price}</p>

                <p><b>Outbound:</b> ${f.departure} → ${f.arrival}</p>

                // ${f.returnDeparture ? `
                //     <p><b>Return:</b> ${f.returnDeparture} → ${f.returnArrival}</p>
                // ` : ""}

                <p>Duration: ${durationText}</p>
                <p>Stops: ${f.stops}</p>
                <button>Book</button>
            </div>
            <hr/>
            `;
        });
    };

    form.addEventListener("input",async(event)=>{
        if(form.value.length<2) return;
        const res=await fetch(`${url}api/airports/search?keyword=${form.value}`);
        const data =await res.json();
        formlist.innerHTML="";
        data.forEach(a => {
            let div=document.createElement("div");
            div.innerHTML = `<b>${a.code}</b> - ${a.city}, ${a.name}`;
            div.onclick=()=>{
                form.value=`${a.code}`;
                formlist.innerHTML="";
            }
            formlist.appendChild(div);
        });
    });

    to.addEventListener("input",async(event)=>{
        if(to.value.length<2) return;

        const res=await fetch(`${url}api/airports/search?keyword=${to.value}`)
        const data=await res.json();
        tolist.innerHTML="";
        data.forEach(a =>{
            let div=document.createElement("div");
            div.innerHTML=`<b>${a.code}</b> - ${a.city},${a.name}`;
            div.onclick=()=>{
                to.value=`${a.code}`;
                tolist.innerHTML="";

            }
            tolist.appendChild(div);
        });
    });

</script>
</html>